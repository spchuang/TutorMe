import os
from flask import Flask, request, redirect, url_for, send_from_directory
from werkzeug import secure_filename
import base64
import random

app = Flask(__name__)

UPLOAD_FOLDER = './uploaded'
app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER

@app.route('/uploads/<filename>')
def uploaded_file(filename):
  return send_from_directory(app.config['UPLOAD_FOLDER'],
                               filename)

@app.route('/upload', methods=['POST'])
def upload_file():
  data = request.form['file']
  hash = random.getrandbits(128)

  filename = str(hash) + '.jpg'

  g = open(app.config['UPLOAD_FOLDER'] +  '/' + filename, "w")
  g.write(base64.decodestring(data))
  g.close()

  return redirect(url_for('uploaded_file',
                              filename=filename))

@app.route('/upload_view', methods=['GET', 'POST'])
def upload_view():

  return '''
  <!doctype html>
  <title>Upload new File</title>
  <h1>Upload new File</h1>
  <form action="/upload" method=post>
    <p><input type=textarea name=file value ='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'>
       <input type=submit value=Upload>
  </form>
  '''

@app.route("/")
def hello():
  return "Hello World!"

if __name__ == "__main__":
  app.run(debug=True)